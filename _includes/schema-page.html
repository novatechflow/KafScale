{% assign page_url = site.url | append: page.url %}
{% assign segments = page.url | split: "/" %}
{% assign path = "" %}
{% assign position = 1 %}
{% capture breadcrumb_items %}
{"@type":"ListItem","position":1,"name":"Home","item":"{{ site.url }}/"}{% for segment in segments %}{% if segment != "" %}{% assign position = position | plus: 1 %}{% assign path = path | append: segment | append: "/" %}{% assign crumb_name = segment | replace: "-", " " | capitalize %}{% if forloop.last and page.title %}{% assign crumb_name = page.title %}{% endif %}, {"@type":"ListItem","position":{{ position }},"name":"{{ crumb_name }}","item":"{{ site.url }}/{{ path }}"}{% endif %}{% endfor %}
{% endcapture %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "name": "{{ page.title | escape }}",
      "description": "{{ page.description | default: site.description | escape }}",
      "url": "{{ page_url }}",
      "isPartOf": {
        "@type": "WebSite",
        "name": "{{ site.title | escape }}",
        "url": "{{ site.url }}"
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {{ breadcrumb_items | strip_newlines }}
      ]
    }{% if page.schema %},
    {{ page.schema | jsonify }}{% endif %}
  ]
}
</script>
